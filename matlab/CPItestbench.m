% MATLAB Code for CPI Analysis - Hardcoded Full Dataset
% Αυτό το script περιέχει όλα τα δεδομένα (24 configurations ανά benchmark)
% και παράγει τα 4 συγκριτικά γραφήματα.

clear; clc; close all;

%% --- ΔΕΔΟΜΕΝΑ (Hardcoded) ---

% --- 1. BENCHMARK: bzip2 ---
bzip2_labels = { ...
    'L1i32k-a1_L1d64k-a4_L2-2M', 'L1i32k-a1_L1d64k-a4_L2-4M', ...
    'L1i32k-a1_L1d64k-a8_L2-2M', 'L1i32k-a1_L1d64k-a8_L2-4M', ...
    'L1i32k-a1_L1d128k-a4_L2-2M', 'L1i32k-a1_L1d128k-a4_L2-4M', ...
    'L1i32k-a1_L1d128k-a8_L2-2M', 'L1i32k-a1_L1d128k-a8_L2-4M', ...
    'L1i32k-a2_L1d64k-a4_L2-2M', 'L1i32k-a2_L1d64k-a4_L2-4M', ...
    'L1i32k-a2_L1d64k-a8_L2-2M', 'L1i32k-a2_L1d64k-a8_L2-4M', ...
    'L1i32k-a2_L1d128k-a4_L2-2M', 'L1i32k-a2_L1d128k-a4_L2-4M', ...
    'L1i32k-a2_L1d128k-a8_L2-2M', 'L1i32k-a2_L1d128k-a8_L2-4M', ...
    'L1-64k-a4_L2-2M', 'L1-64k-a4_L2-4M', ...
    'L1-64k-a8_L2-2M', 'L1-64k-a8_L2-4M', ...
    'L1-128k-a4_L2-2M', 'L1-128k-a4_L2-4M', ...
    'L1-128k-a8_L2-2M', 'L1-128k-a8_L2-4M' ...
};

bzip2_cpi = [ ...
    1.668271, 1.640725, 1.662000, 1.634609, ...
    1.644572, 1.616918, 1.640261, 1.612924, ...
    1.668391, 1.640731, 1.662070, 1.634570, ...
    1.644643, 1.616974, 1.640385, 1.612873, ...
    1.660740, 1.635076, 1.654375, 1.628651, ...
    1.637125, 1.611404, 1.632979, 1.607446 ...
];

% --- 2. BENCHMARK: mcf ---
mcf_labels = { ...
    'L1i32k-a1_L1d64k-a4_L2-2M', 'L1i32k-a1_L1d64k-a4_L2-4M', ...
    'L1i32k-a1_L1d64k-a8_L2-2M', 'L1i32k-a1_L1d64k-a8_L2-4M', ...
    'L1i32k-a1_L1d128k-a4_L2-2M', 'L1i32k-a1_L1d128k-a4_L2-4M', ...
    'L1i32k-a1_L1d128k-a8_L2-2M', 'L1i32k-a1_L1d128k-a8_L2-4M', ...
    'L1i32k-a2_L1d64k-a4_L2-2M', 'L1i32k-a2_L1d64k-a4_L2-4M', ...
    'L1i32k-a2_L1d64k-a8_L2-2M', 'L1i32k-a2_L1d64k-a8_L2-4M', ...
    'L1i32k-a2_L1d128k-a4_L2-2M', 'L1i32k-a2_L1d128k-a4_L2-4M', ...
    'L1i32k-a2_L1d128k-a8_L2-2M', 'L1i32k-a2_L1d128k-a8_L2-4M', ...
    'L1-64k-a4_L2-2M', 'L1-64k-a4_L2-4M', ...
    'L1-64k-a8_L2-2M', 'L1-64k-a8_L2-4M', ...
    'L1-128k-a4_L2-2M', 'L1-128k-a4_L2-4M', ...
    'L1-128k-a8_L2-2M', 'L1-128k-a8_L2-4M' ...
};

mcf_cpi = [ ...
    1.132978, 1.132651, 1.132926, 1.132658, ...
    1.132700, 1.132395, 1.132646, 1.132355, ...
    1.108578, 1.108231, 1.108497, 1.108233, ...
    1.108361, 1.108074, 1.108361, 1.108074, ...
    1.107753, 1.107436, 1.107701, 1.107384, ...
    1.107390, 1.107072, 1.107389, 1.107072 ...
];

% --- 3. BENCHMARK: sjeng ---
sjeng_labels = { ...
    'L1i32k-a1_L1d64k-a4_L2-2M', 'L1i32k-a1_L1d64k-a4_L2-4M', ...
    'L1i32k-a1_L1d64k-a8_L2-2M', 'L1i32k-a1_L1d64k-a8_L2-4M', ...
    'L1i32k-a1_L1d128k-a4_L2-2M', 'L1i32k-a1_L1d128k-a4_L2-4M', ...
    'L1i32k-a1_L1d128k-a8_L2-2M', 'L1i32k-a1_L1d128k-a8_L2-4M', ...
    'L1i32k-a2_L1d64k-a4_L2-2M', 'L1i32k-a2_L1d64k-a4_L2-4M', ...
    'L1i32k-a2_L1d64k-a8_L2-2M', 'L1i32k-a2_L1d64k-a8_L2-4M', ...
    'L1i32k-a2_L1d128k-a4_L2-2M', 'L1i32k-a2_L1d128k-a4_L2-4M', ...
    'L1i32k-a2_L1d128k-a8_L2-2M', 'L1i32k-a2_L1d128k-a8_L2-4M', ...
    'L1-64k-a4_L2-2M', 'L1-64k-a4_L2-4M', ...
    'L1-64k-a8_L2-2M', 'L1-64k-a8_L2-4M', ...
    'L1-128k-a4_L2-2M', 'L1-128k-a4_L2-4M', ...
    'L1-128k-a8_L2-2M', 'L1-128k-a8_L2-4M' ...
};

sjeng_cpi = [ ...
    10.278747, 10.273757, 10.278619, 10.273769, ...
    10.278276, 10.271773, 10.278362, 10.271820, ...
    10.276243, 10.271888, 10.276950, 10.271970, ...
    10.274925, 10.269680, 10.275010, 10.269783, ...
    9.875443, 9.871248, 9.875515, 9.871093, ...
    9.875216, 9.871404, 9.875216, 9.871404 ...
];

% --- 4. BENCHMARK: lbm ---
lbm_labels = { ...
    'L1i32k-a1_L1d64k-a4_L2-2M', 'L1i32k-a1_L1d64k-a4_L2-4M', ...
    'L1i32k-a1_L1d64k-a8_L2-2M', 'L1i32k-a1_L1d64k-a8_L2-4M', ...
    'L1i32k-a1_L1d128k-a4_L2-2M', 'L1i32k-a1_L1d128k-a4_L2-4M', ...
    'L1i32k-a1_L1d128k-a8_L2-2M', 'L1i32k-a1_L1d128k-a8_L2-4M', ...
    'L1i32k-a2_L1d64k-a4_L2-2M', 'L1i32k-a2_L1d64k-a4_L2-4M', ...
    'L1i32k-a2_L1d64k-a8_L2-2M', 'L1i32k-a2_L1d64k-a8_L2-4M', ...
    'L1i32k-a2_L1d128k-a4_L2-2M', 'L1i32k-a2_L1d128k-a4_L2-4M', ...
    'L1i32k-a2_L1d128k-a8_L2-2M', 'L1i32k-a2_L1d128k-a8_L2-4M', ...
    'L1-64k-a4_L2-2M', 'L1-64k-a4_L2-4M', ...
    'L1-64k-a8_L2-2M', 'L1-64k-a8_L2-4M', ...
    'L1-128k-a4_L2-2M', 'L1-128k-a4_L2-4M', ...
    'L1-128k-a8_L2-2M', 'L1-128k-a8_L2-4M' ...
};

lbm_cpi = [ ...
    3.502986, 3.498645, 3.502986, 3.498645, ...
    3.502986, 3.498645, 3.502986, 3.498645, ...
    3.495555, 3.491403, 3.495555, 3.491403, ...
    3.495555, 3.491403, 3.495555, 3.491403, ...
    3.435670, 3.431821, 3.435670, 3.431933, ...
    3.435670, 3.431933, 3.435670, 3.431933 ...
];

%% --- ΟΡΓΑΝΩΣΗ ΔΕΔΟΜΕΝΩΝ ΚΑΙ ΣΧΕΔΙΑΣΗ ---

benchmarks = {'bzip2', 'mcf', 'sjeng', 'lbm'};
all_labels = {bzip2_labels, mcf_labels, sjeng_labels, lbm_labels};
all_cpi = {bzip2_cpi, mcf_cpi, sjeng_cpi, lbm_cpi};

figure('Position', [50, 50, 1400, 900]);

for i = 1:4
    subplot(2, 2, i);
    
    current_cpi = all_cpi{i};
    current_labels = all_labels{i};
    
    % Δημιουργία Bar Chart
    b = bar(current_cpi);
    b.FaceColor = 'flat';
    b.CData = repmat([0.2 0.4 0.7], length(current_cpi), 1); % Μπλε χρώμα
    
    % Επισήμανση της βέλτιστης τιμής (Ελάχιστο CPI) με κόκκινο
    [min_cpi, min_idx] = min(current_cpi);
    b.CData(min_idx, :) = [0.8 0.2 0.2]; % Κόκκινο
    
    title(['Benchmark: ' benchmarks{i}]);
    ylabel('CPI (Cycles Per Instruction)');
    
    % Ρυθμίσεις αξόνων
    set(gca, 'XTick', 1:length(current_labels));
    set(gca, 'XTickLabel', current_labels);
    set(gca, 'FontSize', 8);
    xtickangle(90); % Κάθετες ετικέτες για να χωράνε
    grid on;
    
    % Zoom στον άξονα Y (για να φαίνονται οι μικρές διαφορές)
    range_cpi = max(current_cpi) - min(current_cpi);
    if range_cpi < 0.001
        range_cpi = 0.01; % Ασφάλεια για σχεδόν ίσες τιμές
    end
    ylim([min(current_cpi) - range_cpi*0.2, max(current_cpi) + range_cpi*0.1]);
    
    % Εμφάνιση τιμής μόνο πάνω από το βέλτιστο (για καθαρότητα)
    text(min_idx, min_cpi, sprintf('%.4f', min_cpi), ...
        'vert','bottom','horiz','center', 'FontSize', 9, 'FontWeight', 'bold', 'Color', 'r');
end

sgtitle('Ανάλυση CPI (24 Configurations ανά Benchmark)');
